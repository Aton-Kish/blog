<!doctype html><html lang=ja-jp><head><meta charset=utf-8><link crossorigin=anonymous media=all rel=stylesheet href=https://aton-kish.github.io/blog/css/frameworks.css><link crossorigin=anonymous media=all rel=stylesheet href=https://aton-kish.github.io/blog/css/github.css><link crossorigin=anonymous media=all rel=stylesheet href=https://aton-kish.github.io/blog/css/custom.css><link crossorigin=anonymous media="(prefers-color-scheme: dark)" rel=stylesheet href=https://aton-kish.github.io/blog/css/dark.css><meta name=viewport content="width=device-width"><meta name=description content="OpenStack UssuriをUbuntu 20.04 LTSに追加インストールその１―Octavia編"><meta name=keywords content="OpenStack,Ussuri,Octavia,Ubuntu"><meta name=robots content="noodp"><link rel=canonical href=https://aton-kish.github.io/blog/post/2021/02/13/openstack-ussuri-octavia/><meta name=twitter:card content="summary"><meta name=twitter:title content="OpenStack Ussuri 追加インストールその１―Octavia編 - Nota"><meta name=twitter:description content="OpenStack UssuriをUbuntu 20.04 LTSに追加インストールその１―Octavia編"><meta name=twitter:site content="https://aton-kish.github.io/blog/"><meta name=twitter:creator content><meta name=twitter:image content="https://aton-kish.github.io/blog/"><meta property="og:type" content="article"><meta property="og:title" content="OpenStack Ussuri 追加インストールその１―Octavia編 - Nota"><meta property="og:description" content="OpenStack UssuriをUbuntu 20.04 LTSに追加インストールその１―Octavia編"><meta property="og:url" content="https://aton-kish.github.io/blog/post/2021/02/13/openstack-ussuri-octavia/"><meta property="og:site_name" content="OpenStack Ussuri 追加インストールその１―Octavia編"><meta property="og:image" content="https://aton-kish.github.io/blog/"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2021-02-13 17:59:36 +0900 +0900"><title>OpenStack Ussuri 追加インストールその１―Octavia編 | Nota</title><link rel=apple-touch-icon sizes=180x180 href=https://aton-kish.github.io/blog/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://aton-kish.github.io/blog/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://aton-kish.github.io/blog/favicon-16x16.png><link rel=manifest href=https://aton-kish.github.io/blog/site.webmanifest><link rel=mask-icon href=https://aton-kish.github.io/blog/safari-pinned-tab.svg color=#000000><link rel="shortcut icon" href=https://aton-kish.github.io/blog/favicon.ico><meta name=msapplication-TileColor content="#000000"><meta name=msapplication-config content="https://aton-kish.github.io/blog/browserconfig.xml"><meta name=theme-color content="#ffffff"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-177653883-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-177653883-1');</script></head><body class="env-production emoji-size-boost page-responsive page-profile"><div class="position-relative js-header-wrapper"><span class="Progress progress-pjax-loader position-fixed width-full js-pjax-loader-bar"><span class="progress-pjax-loader-bar top-0 left-0" style=width:0%></span></span><header class="Header py-lg-0 js-details-container Details flex-wrap flex-lg-nowrap p-responsive" role=banner><div class="Header-item d-none d-lg-flex"><a class=Header-link href=https://aton-kish.github.io/blog/ aria-label=Homepage data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a></div><div class="Header-item Header-item--full flex-column flex-lg-row width-full flex-order-2 flex-lg-order-none mr-0 mr-lg-3 mt-3 mt-lg-0 Details-content--hidden"><div class="header-search flex-self-stretch flex-lg-self-auto mr-0 mr-lg-3 mb-3 mb-lg-0 scoped-search site-scoped-search js-site-search position-relative js-jump-to" role=combobox aria-owns=jump-to-results aria-label="Search or jump to" aria-haspopup=listbox aria-expanded=false><div class=position-relative></div></div></div><nav class=d-flex aria-label=Global><a class="js-selected-navigation-item Header-link py-lg-3">&nbsp;</a></nav><div class="Header-item Header-item--full flex-justify-center d-lg-none position-relative" style=margin-right:auto><a class=Header-link href=https://aton-kish.github.io/blog/ aria-label=Homepage data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a></div><div class="Header-item position-relative mr-0 d-none d-lg-flex"><details class="details-overlay details-reset"><summary class=Header-link aria-label="View profile and more" data-ga-click="Header, show menu, icon:avatar"><img alt class="avatar avatar-user" src=https://aton-kish.github.io/blog/images/avatar.png height=20 width=20></summary></details></div></header></div><div id=start-of-content class=show-on-focus></div><div id=js-flash-container></div><div class=application-main data-commit-hovercards-enabled><div itemscope itemtype=http://schema.org/SoftwareSourceCode><main><div class="pagehead repohead instapaper_ignore readability-menu experiment-repo-nav pt-0 pt-lg-4"><div class="repohead-details-container clearfix container-lg p-responsive d-none d-lg-block"><div class="mb-3 d-flex"><h1 class="public css-truncate float-none flex-auto width-fit pl-0"><a class="avatar mr-1" href=https://aton-kish.github.io/blog/about/><img class=avatar-user src=https://aton-kish.github.io/blog/images/avatar.png width=26 height=26></a>
<span class=author><a href=https://aton-kish.github.io/blog/>Aton-Kish</a></span>
<span class=path-divider>/</span>
<strong itemprop=name class=css-truncate-target style=max-width:410px><a href=https://aton-kish.github.io/blog/post/2021/02/13/openstack-ussuri-octavia/>OpenStack Ussuri 追加インストールその１―Octavia編</a></strong><div class="d-block text-small text-gray">Created <time-ago datetime="2021/02/13 17:59:36" class=no-wrap title="Created at 2021/02/13 17:59:36">2021-02-13 17:59:36</time-ago>
<span class=file-info-divider></span>Modified <time-ago datetime="2021/03/15 17:08:27" class=no-wrap title="Modified  at 2021/03/15 17:08:27">2021-03-15</time-ago></div></h1></div></div></div><div class="container-lg clearfix new-discussion-timeline experiment-repo-nav p-responsive"><div class=repository-content><div class="Box mt-3 position-relative"><div class="Box-header py-2 d-flex flex-column flex-shrink-0 flex-md-row flex-md-items-center"><div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">6517 Words</div></div><div id=readme class="Box-body readme blob instapaper_body js-code-block-container"><article class="markdown-body entry-content p-3 p-md-6" itemprop=text><h1 id=openstack-ussuri-追加インストールその１octavia-編>OpenStack Ussuri 追加インストールその１―Octavia 編</h1><ul><li><a href=https://aton-kish.github.io/blog/post/2020/09/11/openstack-ussuri-installation/>OpenStack Ussuriをマニュアルインストールしてみたメモ</a> で構築した OpenStack を拡張していきます</li></ul><h2 id=アーキテクチャ>アーキテクチャ</h2><p><img src=https://user-images.githubusercontent.com/38515249/107854611-4ba5b980-6e60-11eb-851f-89276778ea9a.png alt=openstack_architecture+octavia></p><ul><li><a href=https://aton-kish.github.io/blog/post/2020/09/11/openstack-ussuri-installation/>OpenStack Ussuriをマニュアルインストールしてみたメモ</a>のアーキテクチャに対して、今回はコントローラノードに新しく Octavia を導入する</li></ul><hr><p><span class=label style=background-color:#053260>Controller</span></p><ul><li>Octavia はロードバランササービス</li><li>Neutron server と同じノードにインストールすることを前提としているらしいのでコントローラノード（あるいはネットワークノードを分けている場合はネットワークノード）にインストールしていく</li><li>コンピュートノード上に<a href=https://www.haproxy.com/>HAProxy</a>を稼働する Amphora という VM を建ててロードバランシングする</li></ul><h2 id=前提条件>前提条件</h2><p><a href=https://docs.openstack.org/octavia/ussuri/install/install-ubuntu.html#prerequisites><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1rem" height="1rem" style="fill:currentColor"><path d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg>OpenStack Docs: Install and configure for Ubuntu - Prerequisites</a></p><ol><li><p>Octavia をインストールする前にデータベースを作成する必要がある</p><p><span class=label style=background-color:#f2a50c><span class=overlay style=margin-right:2px>#</span>root user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mysql
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#75715e># 以下は`MariaDB [(none)]&gt;`のプロンプトに入力する
</span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>DATABASE</span> octavia;
<span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>ALL</span> <span style=color:#66d9ef>PRIVILEGES</span> <span style=color:#66d9ef>ON</span> octavia.<span style=color:#f92672>*</span> <span style=color:#66d9ef>TO</span> <span style=color:#e6db74>&#39;octavia&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;localhost&#39;</span> <span style=color:#66d9ef>IDENTIFIED</span> <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;OCTAVIA_DBPASS&#39;</span>;
<span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>ALL</span> <span style=color:#66d9ef>PRIVILEGES</span> <span style=color:#66d9ef>ON</span> octavia.<span style=color:#f92672>*</span> <span style=color:#66d9ef>TO</span> <span style=color:#e6db74>&#39;octavia&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;%&#39;</span> <span style=color:#66d9ef>IDENTIFIED</span> <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;OCTAVIA_DBPASS&#39;</span>;
</code></pre></div><ul><li><span class="label danger"><span class=overlay style=margin-right:2px>!</span>Caution</span>
<strong><code>OCTAVIA_DBPASS</code>は適切なパスワードに書き換える</strong></li><li><code>octavia</code>データベースの作成とアクセス権限の付与</li></ul></li><li><p><code>admin</code>環境スクリプトの読み込み</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>. admin-openrc
</code></pre></div></li><li><p>サービス資格情報作成</p><ul><li><p><code>octavia</code>ユーザ作成</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack user create --domain default --password-prompt octavia
<span style=color:#75715e># 対話形式のパスワードプロンプトがでる</span>
User Password:
Repeat User Password:
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>+---------------------+----------------------------------+
| Field               | Value                            |
+---------------------+----------------------------------+
| domain_id           | default                          |
| enabled             | True                             |
| id                  | b18ee38e06034b748141beda8fc8bfad |
| name                | octavia                          |
| options             | <span style=color:#f92672>{}</span>                               |
| password_expires_at | None                             |
+---------------------+----------------------------------+
</code></pre></div><ul><li><span class="label danger"><span class=overlay style=margin-right:2px>!</span>Caution</span>
<strong>パスワードプロンプトでは<code>OCTAVIA_PASS</code>を入力</strong></li></ul></li><li><p><code>service</code>プロジェクト、<code>octavia</code>ユーザに<code>admin</code>の役割を割り当てる</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack role add --project service --user octavia admin
</code></pre></div></li><li><p><code>load-balancer</code>サービス (<code>name: octavia</code>) を作成</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack service create --name octavia --description <span style=color:#e6db74>&#34;OpenStack Octavia&#34;</span> load-balancer
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | OpenStack Octavia                |
| enabled     | True                             |
| id          | d854f6fff0a64f77bda8003c8dedfada |
| name        | octavia                          |
| type        | load-balancer                    |
+-------------+----------------------------------+
</code></pre></div></li></ul></li><li><p><code>load-balancer</code>サービスに API エンドポイント作成</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack endpoint create --region RegionOne load-balancer public http://controller:9876
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 47cf883de46242c39f147c52f2958ebf |
| interface    | public                           |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | d854f6fff0a64f77bda8003c8dedfada |
| service_name | octavia                          |
| service_type | load-balancer                    |
| url          | http://controller:9876           |
+--------------+----------------------------------+
</code></pre></div><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack endpoint create --region RegionOne load-balancer internal http://controller:9876
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 225aef8465ef4df48a341aaaf2b0a390 |
| interface    | internal                         |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | d854f6fff0a64f77bda8003c8dedfada |
| service_name | octavia                          |
| service_type | load-balancer                    |
| url          | http://controller:9876           |
+--------------+----------------------------------+
</code></pre></div><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack endpoint create --region RegionOne load-balancer admin http://controller:9876
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 375eb5057fb546edbdf3ee4866179672 |
| interface    | admin                            |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | d854f6fff0a64f77bda8003c8dedfada |
| service_name | octavia                          |
| service_type | load-balancer                    |
| url          | http://controller:9876           |
+--------------+----------------------------------+
</code></pre></div><ul><li><code>public</code>、<code>internal</code>、<code>admin</code>にそれぞれ作成</li></ul></li></ol><h3 id=amphora-vm-イメージ作成>Amphora VM イメージ作成</h3><p><a href=https://docs.openstack.org/octavia/ussuri/admin/amphora-image-build.html><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1rem" height="1rem" style="fill:currentColor"><path d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg>OpenStack Docs: Building Octavia Amphora Images</a></p><ul><li>Amphora は内部で HAProxy を動かしてロードバランシングしてくれる VM</li><li>今回は OpenStack 上に Ubuntu Server 20.04 LTS の VM を建てて作成することにしました<br>（そこまで環境汚染されることもないと思うのでコントローラノード上で直接作成しても問題ないです）</li><li>（ここからは VM 上での作業のつもりです）</li></ul><ol><li><p>環境構築</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo apt update
sudo apt install python3-pip qemu-utils git kpartx debootstrap
<span style=color:#75715e># Python 3 が入っていなければ `python3` もインストールする</span>
sudo pip3 install pipenv
git clone https://opendev.org/openstack/octavia.git
cd octavia/diskimage-create
git checkout stable/ussuri
pipenv install -r requirements.txt
</code></pre></div><ul><li>公式ドキュメントでは Pipenv ではなく Virtualenv を使ってます（正直どっちでもいいと思います）</li><li>ブランチを<code>stable/ussuri</code>に変えているが、ディスク作成スクリプトのオプションでブランチを指定することもできるみたい</li></ul></li><li><p>作成</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>pipenv run ./diskimage-create.sh
</code></pre></div><ul><li>デフォルトでは Ubuntu 18.04 ベースのイメージを作成する（<code>-d</code>オプションで変更できるみたいだが、<code>focal</code>つまり Ubuntu 20.04 ベースを指定したところエラーが出てしまった）</li><li><code>-g stable/ussuri</code>のようにブランチ指定もできるらしい</li></ul></li><li><p>イメージ移動</p><ul><li>カレントディレクトリに<code>amphora-x64-haproxy.qcow2</code>が生成されているので、これをコントローラノードに移動する（<code>scp</code>コマンドなど適当に）</li></ul></li></ol><h3 id=amphora-vm-イメージ登録>Amphora VM イメージ登録</h3><p><a href=https://docs.openstack.org/octavia/ussuri/install/install-ubuntu.html#prerequisites><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1rem" height="1rem" style="fill:currentColor"><path d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg>OpenStack Docs: Install and configure for Ubuntu - Prerequisites</a></p><ul><li>（ここからはコントローラノード上での作業です）</li></ul><ol><li><p><code>octavia</code>ユーザ用の環境スクリプト<code>octavia-openrc</code>を作成する</p><pre><code class=language-octavia-openrc data-lang=octavia-openrc>export OS_PROJECT_DOMAIN_NAME=Default
export OS_USER_DOMAIN_NAME=Default
export OS_PROJECT_NAME=service
export OS_USERNAME=octavia
export OS_PASSWORD=OCTAVIA_PASS
export OS_AUTH_URL=http://controller:5000/v3
export OS_IDENTITY_API_VERSION=3
export OS_IMAGE_API_VERSION=2
export OS_VOLUME_API_VERSION=3
</code></pre><ul><li><strong><code>OCTAVIA_PASS</code>は<code>octavia</code>ユーザのパスワードに書き換える</strong></li></ul></li><li><p><code>octavia</code>環境スクリプトの読み込み</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>. octavia-openrc
</code></pre></div></li><li><p>Amphora イメージを<code>QCOW2</code>ディスク形式、ベアコンテナ形式で Glance に登録</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack image create <span style=color:#e6db74>&#34;amphora-x64-haproxy&#34;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    --tag amphora <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    --file ./path/to/amphora-x64-haproxy.qcow2 <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    --disk-format qcow2 <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    --container-format bare <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    --private
</code></pre></div><ul><li><code>--private</code>を指定しているので<code>service</code>プロジェクトからしか参照できない<ul><li>不都合ある場合は<code>--public</code>にするか、他の環境で作成しましょう</li></ul></li></ul></li><li><p>Amphora 用フレーバー作成</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack flavor create --id <span style=color:#ae81ff>200</span> --vcpus <span style=color:#ae81ff>1</span> --ram <span style=color:#ae81ff>1024</span> --disk <span style=color:#ae81ff>2</span> <span style=color:#e6db74>&#34;amphora&#34;</span> --private
</code></pre></div><ul><li><code>--id 200</code>は適宜重複しないように変更する</li><li>ディスク容量は<code>2G</code>にしてあるが適宜増やしてもよいかもしれない</li><li><code>--private</code>を指定しているので<code>service</code>プロジェクトからしか参照できない<ul><li>不都合ある場合は<code>--public</code>にするか、他の環境で作成しましょう</li></ul></li></ul></li></ol><hr><h2 id=octavia-証明書発行>Octavia 証明書発行</h2><p><a href=https://docs.openstack.org/octavia/latest/admin/guides/certificates.html#creating-the-certificate-authorities><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1rem" height="1rem" style="fill:currentColor"><path d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg>OpenStack Docs: Octavia Certificate Configuration Guide - Creating the Certificate Authorities</a></p><ul><li>Octavia の各種プロセスと Amphora 間では TLS 接続がおこなわれる</li><li>双方向に TLS 認証するための証明書を発行する</li><li>（正直あまりわかっていないです）</li></ul><ol><li><p>認証局の作業ディレクトリ作成</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mkdir -m700 certs
cd certs
</code></pre></div><ul><li>デリケートな情報なので権限管理はしっかりしておきましょう</li></ul></li><li><p>OpenSSL 構成ファイル<code>openssl.cnf</code>作成</p><pre><code class=language-openssl.cnf data-lang=openssl.cnf># OpenSSL root CA configuration file.

[ ca ]
# `man ca`
default_ca = CA_default

[ CA_default ]
# Directory and file locations.
dir               = ./
certs             = $dir/certs
crl_dir           = $dir/crl
new_certs_dir     = $dir/newcerts
database          = $dir/index.txt
serial            = $dir/serial
RANDFILE          = $dir/private/.rand

# The root key and root certificate.
private_key       = $dir/private/ca.key.pem
certificate       = $dir/certs/ca.cert.pem

# For certificate revocation lists.
crlnumber         = $dir/crlnumber
crl               = $dir/crl/ca.crl.pem
crl_extensions    = crl_ext
default_crl_days  = 30

# SHA-1 is deprecated, so use SHA-2 instead.
default_md        = sha256

name_opt          = ca_default
cert_opt          = ca_default
default_days      = 3650
preserve          = no
policy            = policy_strict

[ policy_strict ]
# The root CA should only sign intermediate certificates that match.
# See the POLICY FORMAT section of `man ca`.
countryName             = match
stateOrProvinceName     = match
organizationName        = match
organizationalUnitName  = optional
commonName              = supplied
emailAddress            = optional

[ req ]
# Options for the `req` tool (`man req`).
default_bits        = 2048
distinguished_name  = req_distinguished_name
string_mask         = utf8only

# SHA-1 is deprecated, so use SHA-2 instead.
default_md          = sha256

# Extension to add when the -x509 option is used.
x509_extensions     = v3_ca

[ req_distinguished_name ]
# See &lt;https://en.wikipedia.org/wiki/Certificate_signing_request&gt;.
countryName                     = Country Name (2 letter code)
stateOrProvinceName             = State or Province Name
localityName                    = Locality Name
0.organizationName              = Organization Name
organizationalUnitName          = Organizational Unit Name
emailAddress                    = Email Address
commonName                      = Common Name

# ここの部分を変えておくと作業が非常に楽になる
# Optionally, specify some defaults.
countryName_default             = [国名2文字コード、JPなど]
stateOrProvinceName_default     = [都道府県、Tokyoなど]
localityName_default            = [市区町村]
0.organizationName_default      = [組織名]
organizationalUnitName_default  = [組織内の部署名とか？]
emailAddress_default            = [メールアドレス]
commonName_default              = [コモンネーム、ドメイン名やIPアドレス（ワイルドカード使用可）]

[ v3_ca ]
# Extensions for a typical CA (`man x509v3_config`).
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid:always,issuer
basicConstraints = critical, CA:true
keyUsage = critical, digitalSignature, cRLSign, keyCertSign

[ usr_cert ]
# Extensions for client certificates (`man x509v3_config`).
basicConstraints = CA:FALSE
nsCertType = client, email
nsComment = &quot;OpenSSL Generated Client Certificate&quot;
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid,issuer
keyUsage = critical, nonRepudiation, digitalSignature, keyEncipherment
extendedKeyUsage = clientAuth, emailProtection

[ server_cert ]
# Extensions for server certificates (`man x509v3_config`).
basicConstraints = CA:FALSE
nsCertType = server
nsComment = &quot;OpenSSL Generated Server Certificate&quot;
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid,issuer:always
keyUsage = critical, digitalSignature, keyEncipherment
extendedKeyUsage = serverAuth

[ crl_ext ]
# Extension for CRLs (`man x509v3_config`).
authorityKeyIdentifier=keyid:always
</code></pre><ul><li><code>default_days</code>や<code>default_bits</code>、<code>[ req_distinguished_name ]</code>フィールドの項目を適宜変更する</li></ul></li><li><p>サーバ、クライアントの 2 つの認証局</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mkdir server_ca
mkdir client_ca
</code></pre></div></li><li><p>サーバ認証局準備</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cd server_ca
mkdir certs crl newcerts private
chmod <span style=color:#ae81ff>700</span> private
touch index.txt
echo <span style=color:#ae81ff>1000</span> &gt; serial
</code></pre></div></li><li><p>サーバ CA 用の鍵生成</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openssl genrsa -aes256 -out private/ca.key.pem <span style=color:#ae81ff>4096</span>
chmod <span style=color:#ae81ff>400</span> private/ca.key.pem
</code></pre></div><ul><li><strong>適宜パスワードを設定する</strong></li></ul></li><li><p>サーバ CA 証明書発行</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openssl req -config ../openssl.cnf -key private/ca.key.pem -new -x509 -days <span style=color:#ae81ff>7300</span> -sha256 -extensions v3_ca -out certs/ca.cert.pem
</code></pre></div><ul><li><strong>5. サーバ CA 用の鍵の生成時に指定したパスワードが必要</strong></li><li><code>openssl.cnf</code>の<code>[ req_distinguished_name ]</code>フィールドから修正する必要があれば修正する<ul><li><strong><code>Common Name</code>は必ず記入すること</strong></li></ul></li></ul></li><li><p>クライアント認証局準備</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cd ../client_ca
mkdir certs crl csr newcerts private
chmod <span style=color:#ae81ff>700</span> private
touch index.txt
echo <span style=color:#ae81ff>1000</span> &gt; serial
</code></pre></div></li><li><p>クライアント CA 用の鍵生成</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openssl genrsa -aes256 -out private/ca.key.pem <span style=color:#ae81ff>4096</span>
chmod <span style=color:#ae81ff>400</span> private/ca.key.pem
</code></pre></div><ul><li><strong>適宜パスワードを設定する</strong></li></ul></li><li><p>クライアント CA 証明書発行</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openssl req -config ../openssl.cnf -key private/ca.key.pem -new -x509 -days <span style=color:#ae81ff>7300</span> -sha256 -extensions v3_ca -out certs/ca.cert.pem
</code></pre></div><ul><li><strong>8. クライアント CA 用の鍵の生成時に指定したパスワードが必要</strong></li><li><code>openssl.cnf</code>の<code>[ req_distinguished_name ]</code>フィールドから修正する必要があれば修正する<ul><li><strong><code>Common Name</code>は必ず記入すること</strong></li></ul></li></ul></li><li><p>コントローラで使用するクライアント証明書の鍵生成</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openssl genrsa -aes256 -out private/client.key.pem <span style=color:#ae81ff>2048</span>
</code></pre></div><ul><li><strong>適宜パスワードを設定する</strong></li></ul></li><li><p>コントローラで使用するクライアント証明書の証明書署名要求(CSR)を作成</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openssl req -config ../openssl.cnf -new -sha256 -key private/client.key.pem -out csr/client.csr.pem
</code></pre></div><ul><li><strong>10. コントローラで使用するクライアント証明書の鍵の生成時に指定したパスワードが必要</strong></li><li><code>openssl.cnf</code>の<code>[ req_distinguished_name ]</code>フィールドから修正する必要があれば修正する<ul><li><strong><code>Common Name</code>は必ず記入すること</strong></li></ul></li></ul></li><li><p>クライアント証明書要求に署名</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openssl ca -config ../openssl.cnf -extensions usr_cert -days <span style=color:#ae81ff>7300</span> -notext -md sha256 -in csr/client.csr.pem -out certs/client.cert.pem
</code></pre></div><ul><li><strong>8. クライアント CA 用の鍵の生成時に指定したパスワードが必要</strong></li></ul></li><li><p>クライアント証明書と鍵を連結する</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openssl rsa -in private/client.key.pem -out private/client.cert-and-key.pem
cat certs/client.cert.pem &gt;&gt; private/client.cert-and-key.pem
</code></pre></div><ul><li><strong>10. コントローラで使用するクライアント証明書の鍵の生成時に指定したパスワードが必要</strong></li></ul></li></ol><hr><h2 id=octavia-インストール>Octavia インストール</h2><p><a href=https://docs.openstack.org/octavia/ussuri/install/install-ubuntu.html#install-and-configure-components><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1rem" height="1rem" style="fill:currentColor"><path d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg>OpenStack Docs: Install and configure for Ubuntu - Install and configure components</a></p><p><a href=https://docs.openstack.org/octavia/latest/admin/guides/certificates.html#configuring-octavia><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1rem" height="1rem" style="fill:currentColor"><path d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg>OpenStack Docs: Octavia Certificate Configuration Guide - Configuring Octavia</a></p><ol><li><p>パッケージインストール</p><p><span class=label style=background-color:#f2a50c><span class=overlay style=margin-right:2px>#</span>root user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>apt install <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    octavia-api <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    octavia-health-manager <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    octavia-housekeeping <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    octavia-worker <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    python3-octavia <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    python3-octaviaclient
</code></pre></div></li><li><p>証明書を配置する</p><p><span class=label style=background-color:#f2a50c><span class=overlay style=margin-right:2px>#</span>root user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cd certs
mkdir -m700 /etc/octavia/certs
cp server_ca/private/ca.key.pem /etc/octavia/certs/server_ca.key.pem
chmod <span style=color:#ae81ff>700</span> /etc/octavia/certs/server_ca.key.pem
cp server_ca/certs/ca.cert.pem /etc/octavia/certs/server_ca.cert.pem
cp client_ca/certs/ca.cert.pem /etc/octavia/certs/client_ca.cert.pem
cp client_ca/private/client.cert-and-key.pem /etc/octavia/certs/client.cert-and-key.pem
chmod <span style=color:#ae81ff>700</span> /etc/octavia/certs/client.cert-and-key.pem
chown -R octavia:octavia /etc/octavia/certs
</code></pre></div><ul><li>最初の<code>cd certs</code>は<a href=#octavia-%E8%A8%BC%E6%98%8E%E6%9B%B8%E7%99%BA%E8%A1%8C>Octavia 証明書発行</a>の作業ディレクトリへの移動を意味していることに注意</li></ul></li><li><p><code>octavia</code>環境スクリプトの読み込み</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>. octavia-openrc
</code></pre></div></li><li><p>ロードバランサ用のセキュリティグループとルールを作成する</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack security group create lb-mgmt-sec-grp
openstack security group rule create --protocol icmp lb-mgmt-sec-grp
openstack security group rule create --protocol tcp --dst-port <span style=color:#ae81ff>22</span> lb-mgmt-sec-grp
openstack security group rule create --protocol tcp --dst-port <span style=color:#ae81ff>9443</span> lb-mgmt-sec-grp
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack security group create lb-health-mgr-sec-grp
openstack security group rule create --protocol udp --dst-port <span style=color:#ae81ff>5555</span> lb-health-mgr-sec-grp
</code></pre></div></li><li><p>Amphora インスタンス用の SSH 鍵登録</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack keypair create --public-key ./path/to/id_rsa.pub mykey
</code></pre></div><ul><li><code>mykey</code>はキーペアの名前にあたる部分なので適宜変更する</li></ul></li><li><p><code>dhclient.conf</code>作成</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git clone https://opendev.org/openstack/octavia.git
cd octavia
git checkout stable/ussuri
sudo mkdir -m755 -p /etc/dhcp/octavia
sudo cp etc/dhcp/dhclient.conf /etc/dhcp/octavia
</code></pre></div></li><li><p>ネットワーク作成</p><ol><li><p>ロードバランサネットワークのサブネットなどを決める</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>OCTAVIA_MGMT_SUBNET<span style=color:#f92672>=</span>172.17.0.0/16
OCTAVIA_MGMT_SUBNET_START<span style=color:#f92672>=</span>172.17.0.100
OCTAVIA_MGMT_SUBNET_END<span style=color:#f92672>=</span>172.17.31.254
OCTAVIA_MGMT_PORT_IP<span style=color:#f92672>=</span>172.17.0.2
</code></pre></div><ul><li>OpenStack 内部のプライベートなネットワークを作成するので外部ネットワークとサブネットが重複しないように注意して決めればよい</li></ul></li><li><p>ロードバランサネットワーク作成</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack network create lb-mgmt-net
openstack subnet create <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    --network lb-mgmt-net <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    --allocation-pool start<span style=color:#f92672>=</span>$OCTAVIA_MGMT_SUBNET_START,end<span style=color:#f92672>=</span>$OCTAVIA_MGMT_SUBNET_END <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    --subnet-range $OCTAVIA_MGMT_SUBNET <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    lb-mgmt-subnet

SUBNET_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>openstack subnet show lb-mgmt-subnet -f value -c id<span style=color:#66d9ef>)</span>
PORT_FIXED_IP<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;--fixed-ip subnet=</span>$SUBNET_ID<span style=color:#e6db74>,ip-address=</span>$OCTAVIA_MGMT_PORT_IP<span style=color:#e6db74>&#34;</span>

MGMT_PORT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>openstack port create<span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    --security-group lb-health-mgr-sec-grp <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    --device-owner Octavia:health-mgr <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    --host<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>hostname<span style=color:#66d9ef>)</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -c id <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -f value <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    --network lb-mgmt-net <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    $PORT_FIXED_IP octavia-health-manager-listen-port<span style=color:#66d9ef>)</span>

MGMT_PORT_MAC<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>openstack port show -c mac_address -f value $MGMT_PORT_ID<span style=color:#66d9ef>)</span>

MGMT_PORT_IP<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>openstack port show -f yaml -c fixed_ips <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    $MGMT_PORT_ID | awk <span style=color:#e6db74>&#39;{FS=&#34;,|&#34;;gsub(&#34;,&#34;,&#34;&#34;);gsub(&#34;&#39;</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>&#39;&#34;,&#34;&#34;); \
</span><span style=color:#e6db74>    for(line = 1; line &lt;= NF; ++line) {if ($line ~ /^- ip_address:/) \
</span><span style=color:#e6db74>    {split($line, word, &#34; &#34;);if (ENVIRON[&#34;IPV6_ENABLED&#34;] == &#34;&#34; &amp;&amp; word[3] ~ /\./) \
</span><span style=color:#e6db74>    print word[3];if (ENVIRON[&#34;IPV6_ENABLED&#34;] != &#34;&#34; &amp;&amp; word[3] ~ /:/) print word[3];} \
</span><span style=color:#e6db74>    else {split($line, word, &#34; &#34;);for(ind in word) {if (word[ind] ~ /^ip_address=/) \
</span><span style=color:#e6db74>    {split(word[ind], token, &#34;=&#34;);if (ENVIRON[&#34;IPV6_ENABLED&#34;] == &#34;&#34; &amp;&amp; token[2] ~ /\./) \
</span><span style=color:#e6db74>    print token[2];if (ENVIRON[&#34;IPV6_ENABLED&#34;] != &#34;&#34; &amp;&amp; token[2] ~ /:/) print token[2];}}}}}&#39;</span><span style=color:#66d9ef>)</span>
</code></pre></div><ul><li><p><code>MGMT_PORT_IP</code>と<code>OCTAVIA_MGMT_PORT_IP</code>が一致しているか確認してみるとよいかもしれない</p></li><li><p><strong><code>MGMT_PORT_MAC</code>の値は後ほど使うので控えておく</strong></p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>echo $MGMT_PORT_MAC
</code></pre></div></li></ul></li><li><p>インターフェース作成</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo ip link add o-hm0 type veth peer name o-bhm0
NETID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>openstack network show lb-mgmt-net -c id -f value<span style=color:#66d9ef>)</span>
BRNAME<span style=color:#f92672>=</span>brq<span style=color:#66d9ef>$(</span>echo $NETID|cut -c 1-11<span style=color:#66d9ef>)</span>
sudo brctl addif $BRNAME o-bhm0
sudo ip link set o-bhm0 up

sudo ip link set dev o-hm0 address $MGMT_PORT_MAC
sudo iptables -I INPUT -i o-hm0 -p udp --dport <span style=color:#ae81ff>5555</span> -j ACCEPT
sudo dhclient -v o-hm0 -cf /etc/dhcp/octavia
</code></pre></div><ul><li><p><code>ip a</code>などを叩くと Octavia ヘルスマネージャー用のインターフェース<code>o-hm0</code>に<code>OCTAVIA_MGMT_PORT_IP</code>が振られていることが確認できる</p></li><li><p><strong><code>BRNAME</code>の値は後ほど使うので控えておく</strong></p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>echo $BRNAME
</code></pre></div></li></ul></li></ol></li><li><p>再起動してもネットワーク設定を保持するようにする</p><ol><li><p><code>/etc/systemd/network/o-hm0.network</code>を作成</p><pre><code class=language-o-hm0.network data-lang=o-hm0.network>[Match]
Name=o-hm0

[Network]
DHCP=yes
</code></pre></li><li><p><code>/etc/systemd/system/octavia-interface.service</code>を作成</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-octavia-interface.service data-lang=octavia-interface.service><span style=color:#66d9ef>[Unit]</span>
<span style=color:#a6e22e>Description</span><span style=color:#f92672>=</span><span style=color:#e6db74>Octavia Interface Creator</span>
<span style=color:#a6e22e>Requires</span><span style=color:#f92672>=</span><span style=color:#e6db74>neutron-linuxbridge-agent.service</span>
<span style=color:#a6e22e>After</span><span style=color:#f92672>=</span><span style=color:#e6db74>neutron-linuxbridge-agent.service</span>

<span style=color:#66d9ef>[Service]</span>
<span style=color:#a6e22e>Type</span><span style=color:#f92672>=</span><span style=color:#e6db74>oneshot</span>
<span style=color:#a6e22e>RemainAfterExit</span><span style=color:#f92672>=</span><span style=color:#e6db74>true</span>
<span style=color:#a6e22e>ExecStart</span><span style=color:#f92672>=</span><span style=color:#e6db74>/usr/local/bin/octavia-interface.sh start</span>
<span style=color:#a6e22e>ExecStop</span><span style=color:#f92672>=</span><span style=color:#e6db74>/usr/local/bin/octavia-interface.sh stop</span>

<span style=color:#66d9ef>[Install]</span>
<span style=color:#a6e22e>WantedBy</span><span style=color:#f92672>=</span><span style=color:#e6db74>multi-user.target</span>
</code></pre></div><ul><li><code>ExecStart</code>, <code>ExecStop</code>に指定するスクリプトの保存場所は自由</li></ul></li><li><p><code>/usr/local/bin/octavia-interface.sh</code>を作成</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-octavia-interface.sh data-lang=octavia-interface.sh><span style=color:#75715e>#!/bin/bash
</span><span style=color:#75715e></span>
set -ex

MAC<span style=color:#f92672>=[</span><span style=color:#e6db74>`</span>$MGMT_PORT_MAC<span style=color:#e6db74>`</span>の値に書き換える<span style=color:#f92672>]</span>
BRNAME<span style=color:#f92672>=[</span><span style=color:#e6db74>`</span>$BRNAME<span style=color:#e6db74>`</span>の値に書き換える<span style=color:#f92672>]</span>

<span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;start&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
ip link add o-hm0 type veth peer name o-bhm0
brctl addif $BRNAME o-bhm0
ip link set o-bhm0 up
ip link set dev o-hm0 address $MAC
ip link set o-hm0 up
iptables -I INPUT -i o-hm0 -p udp --dport <span style=color:#ae81ff>5555</span> -j ACCEPT
dhclient -v o-hm0 -cf /etc/dhcp/octavia  <span style=color:#75715e># もしかしたら不要かも？</span>
<span style=color:#66d9ef>elif</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;stop&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
ip link del o-hm0
<span style=color:#66d9ef>else</span>
brctl show $BRNAME
ip a s dev o-hm0
<span style=color:#66d9ef>fi</span>
</code></pre></div><ul><li><p>ドキュメントには<code>dhclient ...</code>の行は書かれていなかったが、うまくアドレスが振られない気がしたので…</p><ul><li>自分の環境の DHCP まわりに問題があっただけかもしれないです</li></ul></li><li><p>実行権限も忘れずに付与する</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo chmod +x /usr/local/bin/octavia-interface.sh
</code></pre></div></li></ul></li></ol></li><li><p><code>/etc/octavia/octavia.conf</code>編集</p><pre><code class=language-octavia.conf data-lang=octavia.conf>[DEFAULT]
# `RABBIT_PASS`は適切なパスワードに書き換える
transport_url = rabbit://openstack:RABBIT_PASS@controller

# ...

[database]
# `OCTAVIA_DBPASS`は適切なパスワードに書き換える
connection = mysql+pymysql://octavia:OCTAVIA_DBPASS@controller/octavia

# ...

[oslo_messaging]
topic = octavia_prov

# ...

[api_settings]
bind_host = 0.0.0.0
bind_port = 9876

# ...

[keystone_authtoken]
# `OCTAVIA_PASS`は適切なパスワードに書き換える
www_authenticate_uri = http://controller:5000
auth_url = http://controller:5000
memcached_servers = controller:11211
auth_type = password
project_domain_name = Default
user_domain_name = Default
project_name = service
username = octavia
password = OCTAVIA_PASS

# ...

[service_auth]
# `OCTAVIA_PASS`は適切なパスワードに書き換える
auth_url = http://controller:5000
memcached_servers = controller:11211
auth_type = password
project_domain_name = Default
user_domain_name = Default
project_name = service
username = octavia
password = OCTAVIA_PASS

# ...

[certificates]
cert_generator = local_cert_generator
ca_certificate = /etc/octavia/certs/server_ca.cert.pem
ca_private_key = /etc/octavia/certs/server_ca.key.pem
ca_private_key_passphrase = [サーバCA鍵のパスワード]
# server_certs_key_passphrase = insecure-key-do-not-use-this-key
server_certs_key_passphrase = [32文字のなんらかの文字列]

# ...

[haproxy_amphora]
client_cert = /etc/octavia/certs/client.cert-and-key.pem
server_ca = /etc/octavia/certs/server_ca.cert.pem

# ...

[health_manager]
# `$OCTAVIA_MGMT_PORT_IP`に指定したアドレスに適宜書き換える
bind_port = 5555
bind_ip = OCTAVIA_MGMT_PORT_IP
controller_ip_port_list = OCTAVIA_MGMT_PORT_IP:5555

# ...

[controller_worker]
amp_image_owner_id = [`service`プロジェクトのID、`openstack project show service`などで調べる]
amp_image_tag = amphora
amp_ssh_key_name = [Amphora用キーペア名、mykeyなど]
amp_secgroup_list = [`lb-mgmt-sec-grp`セキュリティグループのID、`openstack security group show lb-mgmt-sec-grp`などで調べる]
amp_boot_network_list = [`lb-mgmt-net`ネットワークのID、`openstack network show lb-mgmt-net`などで調べる]
amp_flavor_id = [Amphora用フレーバーのID、200など]
network_driver = allowed_address_pairs_driver
compute_driver = compute_nova_driver
amphora_driver = amphora_haproxy_rest_driver
client_ca = /etc/octavia/certs/client_ca.cert.pem

# ...
</code></pre><ul><li><span class="label danger"><span class=overlay style=margin-right:2px>!</span>Caution</span>
<strong><code>RABBIT_PASS</code>は適切なパスワードに書き換える</strong></li><li><span class="label danger"><span class=overlay style=margin-right:2px>!</span>Caution</span>
<strong><code>OCTAVIA_DBPASS</code>は適切なパスワードに書き換える</strong></li><li><span class="label danger"><span class=overlay style=margin-right:2px>!</span>Caution</span>
<strong><code>OCTAVIA_PASS</code>は適切なパスワードに書き換える</strong></li><li><span class="label danger"><span class=overlay style=margin-right:2px>!</span>Caution</span>
<strong><code>server_certs_key_passphrase</code>は 32 文字のなんらかの文字列に書き換える</strong><ul><li>デフォルトでは<code>insecure-key-do-not-use-this-key</code>が使われるが本番環境では変えるべきとのこと</li></ul></li></ul></li><li><p>Octavia データベース更新</p><p><span class=label style=background-color:#f2a50c><span class=overlay style=margin-right:2px>#</span>root user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>octavia-db-manage --config-file /etc/octavia/octavia.conf upgrade head
</code></pre></div></li></ol><hr><h2 id=サービス再起動>サービス再起動</h2><p><a href=https://docs.openstack.org/octavia/ussuri/install/install-ubuntu.html#finalize-installation><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1rem" height="1rem" style="fill:currentColor"><path d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg>OpenStack Docs: Install and configure for Ubuntu - Finalize installation</a></p><p><span class=label style=background-color:#f2a50c><span class=overlay style=margin-right:2px>#</span>root user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>systemctl restart octavia-api
systemctl restart octavia-health-manager
systemctl restart octavia-housekeeping
systemctl restart octavia-worker
</code></pre></div><ul><li>念の為<code>systemctl status</code>で確認しておきましょう<ul><li><code>server_certs_key_passphrase</code>の 32 文字設定に誤っていたりで起動失敗することがあります</li></ul></li></ul><hr><h2 id=amphora-v2-のための追加設定>Amphora v2 のための追加設定</h2><p><a href=https://docs.openstack.org/octavia/ussuri/install/install-amphorav2.html><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1rem" height="1rem" style="fill:currentColor"><path d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg>OpenStack Docs: Additional configuration steps to configure amphorav2 provider</a></p><ul><li>Redis か Zookeeper が追加で必要になりそうなので今回はとりあえず追加設定しません</li></ul><hr><h2 id=動作確認>動作確認</h2><p><a href=https://docs.openstack.org/octavia/ussuri/user/guides/basic-cookbook.html><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1rem" height="1rem" style="fill:currentColor"><path d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg>OpenStack Docs: Basic Load Balancing Cookbook</a></p><ul><li>簡単な HTTP ロードバランサをやってみます</li></ul><ol start=0><li><p>適当に作った<code>selfservice</code>ネットワーク（<code>selfservice</code>サブネット）に Nginx Web サーバの VM を 2 台建てておく</p><ul><li>Web サーバの IP アドレスは<code>10.0.0.11</code>, <code>10.0.0.12</code>と仮定する</li><li>それぞれ<code>Welcome to node1</code>, <code>Welcome to node2</code>を返すように<code>index.html</code>を書き換えておく</li></ul></li><li><p><code>octavia</code>環境スクリプトの読み込み</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>. octavia-openrc
</code></pre></div></li><li><p>ロードバランサ作成</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack loadbalancer create --name http-lb --vip-subnet-id selfservice
</code></pre></div></li><li><p>HTTP をロードバランシングするためのリスナーを作成</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack loadbalancer listener create --name http-listener --protocol HTTP --protocol-port <span style=color:#ae81ff>80</span> http-lb
</code></pre></div></li><li><p>ロードバランサ対象のプールを作成</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack loadbalancer pool create --name http-pool --lb-algorithm ROUND_ROBIN --listener http-listener --protocol HTTP
</code></pre></div><ul><li><code>--lb-algorithm</code>はラウンドロビン以外にもあるようなので適宜変更する</li></ul></li><li><p>プールに Web サーバを参加させる</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack loadbalancer member create --name node1 --subnet-id selfservice --address 10.0.0.11 --protocol-port <span style=color:#ae81ff>80</span> http-pool
openstack loadbalancer member create --name node2 --subnet-id selfservice --address 10.0.0.12 --protocol-port <span style=color:#ae81ff>80</span> http-pool
</code></pre></div></li><li><p>ヘルスモニタ作成</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack loadbalancer healthmonitor create --name http-pool-hm --delay <span style=color:#ae81ff>5</span> --max-retries <span style=color:#ae81ff>4</span> --timeout <span style=color:#ae81ff>10</span> --type HTTP --url-path / http-pool
</code></pre></div><ul><li>VM の様子を監視して、落ちるとプールから自動的に外してくれるらしい（回復すると再び参加するらしい）</li></ul></li><li><p>floating IP の設定</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack floating ip create provider
openstack floating ip set --port <span style=color:#f92672>[</span>http-lbのポートID<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>floating IPのID<span style=color:#f92672>]</span>
</code></pre></div><ul><li>ロードバランサ<code>http-lb</code>にプロバイダネットワークの floating IP を設定することで外部からの疎通ができるようになる<ul><li>floating IP は<code>172.16.100.100</code>が取得できたと仮定する</li></ul></li></ul></li><li><p>アクセスしてみる</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># ...</span>
curl http://172.16.100.100/
Welcome to node1
curl http://172.16.100.100/
Welcome to node2
curl http://172.16.100.100/
Welcome to node1
<span style=color:#75715e># ...</span>
</code></pre></div><ul><li>Web サーバの<code>index.html</code>を書き換えておくとラウンドロビンしている様子がわかりやすい</li><li>つながらない場合は Web サーバを建てているプロジェクトのセキュリティグループが HTTP を通しているか確認しましょう</li></ul></li></ol><hr><h2 id=おわり>おわり</h2><p>以上で Octavia 編終了です<br>お疲れ様でした</p><h3 id=関連記事一覧>関連記事一覧</h3><ul><li><a href=https://aton-kish.github.io/blog/post/2020/09/11/openstack-ussuri-installation/>OpenStack Ussuriをマニュアルインストールしてみたメモ</a><ol><li><a href=https://aton-kish.github.io/blog/post/2020/09/12/openstack-ussuri-environment/>OpenStack Ussuriマニュアルインストールその１―環境構築編</a></li><li><a href=https://aton-kish.github.io/blog/post/2020/09/13/openstack-ussuri-keystone/>OpenStack Ussuriマニュアルインストールその２―Keystone編</a></li><li><a href=https://aton-kish.github.io/blog/post/2020/09/14/openstack-ussuri-glance/>OpenStack Ussuriマニュアルインストールその３―Glance編</a></li><li><a href=https://aton-kish.github.io/blog/post/2020/09/15/openstack-ussuri-placement/>OpenStack Ussuriマニュアルインストールその４―Placement編</a></li><li><a href=https://aton-kish.github.io/blog/post/2020/09/15/openstack-ussuri-nova/>OpenStack Ussuriマニュアルインストールその５―Nova編</a></li><li><a href=https://aton-kish.github.io/blog/post/2020/09/16/openstack-ussuri-neutron/>OpenStack Ussuriマニュアルインストールその６―Neutron編</a></li><li><a href=https://aton-kish.github.io/blog/post/2020/09/17/openstack-ussuri-horizon/>OpenStack Ussuriマニュアルインストールその７―Horizon編</a></li><li><a href=https://aton-kish.github.io/blog/post/2020/09/18/openstack-ussuri-cinder/>OpenStack Ussuriマニュアルインストールその８―Cinder編</a></li><li><a href=https://aton-kish.github.io/blog/post/2020/09/19/openstack-ussuri-launch/>OpenStack Ussuriマニュアルインストールその９―起動編</a></li><li>OpenStack Ussuri 追加インストールその１―Octavia編（当記事）</li></ol></li><li><a href=https://aton-kish.github.io/blog/post/2021/03/14/openstack-victoria-installation/>OpenStack Victoriaをマニュアルインストールしてみたメモ</a></li><li><a href=https://aton-kish.github.io/blog/post/2020/11/27/openstack-tips/>OpenStack Tips</a></li><li>Issues<ol><li><a href=https://aton-kish.github.io/blog/post/2021/03/15/openstack-issue-ebtables/>Openstack Issueその１―正常に見えるのに大量にネットワークエラーが…</a></li><li><a href=https://aton-kish.github.io/blog/post/2021/03/15/openstack-issue-ipv6/>Openstack Issueその２―VMと疎通がとれない…</a></li><li><a href=https://aton-kish.github.io/blog/post/2021/03/15/openstack-issue-nonadmin-horizon/>Openstack Issueその３―Horizon「どこかがおかしくなりました」</a></li><li></li></ol></li></ul></article></div></div></div></div></main></div></div><div class="footer container-lg width-full p-responsive" role=contentinfo><div class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light"><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"><li class="mr-3 mr-lg-0">© 2020 Aton-Kish</a></li></ul><a aria-label=Homepage title=Nota class="footer-octicon d-none d-lg-block mx-lg-4" href=https://aton-kish.github.io/blog/><svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" width="24" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"></ul></div><div class="d-flex flex-justify-center pb-6"><span class="f6 text-gray-light"></span></div></div><script crossorigin=anonymous type=application/javascript src=https://aton-kish.github.io/blog/js/frameworks.js></script><script crossorigin=anonymous type=application/javascript src=https://aton-kish.github.io/blog/js/github-bootstrap.js></script><script src=https://aton-kish.github.io/blog/js/stop.js></script><script src=https://aton-kish.github.io/blog/js/contributions.js></script></body></html>