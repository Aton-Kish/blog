<!doctype html><html lang=ja-jp><head><meta charset=utf-8><link crossorigin=anonymous media=all rel=stylesheet href=https://aton-kish.github.io/blog/css/frameworks.css><link crossorigin=anonymous media=all rel=stylesheet href=https://aton-kish.github.io/blog/css/github.css><link crossorigin=anonymous media=all rel=stylesheet href=https://aton-kish.github.io/blog/css/custom.css><link crossorigin=anonymous media="(prefers-color-scheme: dark)" rel=stylesheet href=https://aton-kish.github.io/blog/css/dark.css><meta name=viewport content="width=device-width"><meta name=description content="Openstack UssuriをUbuntu 20.04 LTSにマニュアルインストールその５―Nova編"><meta name=keywords content="OpenStack,Ussuri,Nova,Ubuntu"><meta name=robots content="noodp"><link rel=canonical href=https://aton-kish.github.io/blog/post/2020/09/15/openstack-ussuri-nova/><meta name=twitter:card content="summary"><meta name=twitter:title content="OpenStack Ussuriマニュアルインストールその５―Nova編 - Nota"><meta name=twitter:description content="Openstack UssuriをUbuntu 20.04 LTSにマニュアルインストールその５―Nova編"><meta name=twitter:site content="https://aton-kish.github.io/blog/"><meta name=twitter:creator content><meta name=twitter:image content="https://aton-kish.github.io/blog/"><meta property="og:type" content="article"><meta property="og:title" content="OpenStack Ussuriマニュアルインストールその５―Nova編 - Nota"><meta property="og:description" content="Openstack UssuriをUbuntu 20.04 LTSにマニュアルインストールその５―Nova編"><meta property="og:url" content="https://aton-kish.github.io/blog/post/2020/09/15/openstack-ussuri-nova/"><meta property="og:site_name" content="OpenStack Ussuriマニュアルインストールその５―Nova編"><meta property="og:image" content="https://aton-kish.github.io/blog/"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2020-09-15 21:24:40 +0900 +0900"><title>OpenStack Ussuriマニュアルインストールその５―Nova編 | Nota</title><link rel=apple-touch-icon sizes=180x180 href=https://aton-kish.github.io/blog/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://aton-kish.github.io/blog/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://aton-kish.github.io/blog/favicon-16x16.png><link rel=manifest href=https://aton-kish.github.io/blog/site.webmanifest><link rel=mask-icon href=https://aton-kish.github.io/blog/safari-pinned-tab.svg color=#000000><link rel="shortcut icon" href=https://aton-kish.github.io/blog/favicon.ico><meta name=msapplication-TileColor content="#000000"><meta name=msapplication-config content="https://aton-kish.github.io/blog/browserconfig.xml"><meta name=theme-color content="#ffffff"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-177653883-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-177653883-1');</script></head><body class="env-production emoji-size-boost page-responsive page-profile"><div class="position-relative js-header-wrapper"><span class="Progress progress-pjax-loader position-fixed width-full js-pjax-loader-bar"><span class="progress-pjax-loader-bar top-0 left-0" style=width:0%></span></span><header class="Header py-lg-0 js-details-container Details flex-wrap flex-lg-nowrap p-responsive" role=banner><div class="Header-item d-none d-lg-flex"><a class=Header-link href=https://aton-kish.github.io/blog/ aria-label=Homepage data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a></div><div class="Header-item Header-item--full flex-column flex-lg-row width-full flex-order-2 flex-lg-order-none mr-0 mr-lg-3 mt-3 mt-lg-0 Details-content--hidden"><div class="header-search flex-self-stretch flex-lg-self-auto mr-0 mr-lg-3 mb-3 mb-lg-0 scoped-search site-scoped-search js-site-search position-relative js-jump-to" role=combobox aria-owns=jump-to-results aria-label="Search or jump to" aria-haspopup=listbox aria-expanded=false><div class=position-relative></div></div></div><nav class=d-flex aria-label=Global><a class="js-selected-navigation-item Header-link py-lg-3">&nbsp;</a></nav><div class="Header-item Header-item--full flex-justify-center d-lg-none position-relative" style=margin-right:auto><a class=Header-link href=https://aton-kish.github.io/blog/ aria-label=Homepage data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a></div><div class="Header-item position-relative mr-0 d-none d-lg-flex"><details class="details-overlay details-reset"><summary class=Header-link aria-label="View profile and more" data-ga-click="Header, show menu, icon:avatar"><img alt class="avatar avatar-user" src=https://aton-kish.github.io/blog/images/avatar.png height=20 width=20></summary></details></div></header></div><div id=start-of-content class=show-on-focus></div><div id=js-flash-container></div><div class=application-main data-commit-hovercards-enabled><div itemscope itemtype=http://schema.org/SoftwareSourceCode><main><div class="pagehead repohead instapaper_ignore readability-menu experiment-repo-nav pt-0 pt-lg-4"><div class="repohead-details-container clearfix container-lg p-responsive d-none d-lg-block"><div class="mb-3 d-flex"><h1 class="public css-truncate float-none flex-auto width-fit pl-0"><a class="avatar mr-1" href=https://aton-kish.github.io/blog/about/><img class=avatar-user src=https://aton-kish.github.io/blog/images/avatar.png width=26 height=26></a>
<span class=author><a href=https://aton-kish.github.io/blog/>Aton-Kish</a></span>
<span class=path-divider>/</span>
<strong itemprop=name class=css-truncate-target style=max-width:410px><a href=https://aton-kish.github.io/blog/post/2020/09/15/openstack-ussuri-nova/>OpenStack Ussuriマニュアルインストールその５―Nova編</a></strong><div class="d-block text-small text-gray">Created <time-ago datetime="2020/09/15 21:24:40" class=no-wrap title="Created at 2020/09/15 21:24:40">2020-09-15 21:24:40</time-ago>
<span class=file-info-divider></span>Modified <time-ago datetime="2021/03/15 15:45:41" class=no-wrap title="Modified  at 2021/03/15 15:45:41">2021-03-15</time-ago></div></h1></div></div></div><div class="container-lg clearfix new-discussion-timeline experiment-repo-nav p-responsive"><div class=repository-content><div class="Box mt-3 position-relative"><div class="Box-header py-2 d-flex flex-column flex-shrink-0 flex-md-row flex-md-items-center"><div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">4572 Words</div></div><div id=readme class="Box-body readme blob instapaper_body js-code-block-container"><article class="markdown-body entry-content p-3 p-md-6" itemprop=text><h1 id=openstack-ussuri-マニュアルインストールその５nova-編>OpenStack Ussuri マニュアルインストールその５―Nova 編</h1><ul><li>Nova は VM インスタンスの起動・停止など管理する</li><li>裏で KVM/QEMU の<code>libvirt</code>を叩く（<code>libvirt</code>以外もできるらしい）</li></ul><h2 id=コントローラノード>コントローラノード</h2><p><a href=https://docs.openstack.org/nova/ussuri/install/controller-install-ubuntu.html><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1rem" height="1rem" style="fill:currentColor"><path d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg>OpenStack Docs: Install and configure controller node for Ubuntu</a></p><p><span class=label style=background-color:#053260>Controller</span></p><ul><li>コントローラノードには主に VM インスタンスを計画的に建てるための API 群が入る（？）</li></ul><h3 id=前提条件>前提条件</h3><p><a href=https://docs.openstack.org/nova/ussuri/install/controller-install-ubuntu.html#prerequisites><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1rem" height="1rem" style="fill:currentColor"><path d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg>OpenStack Docs: Install and configure controller node for Ubuntu - Prerequisites</a></p><ol><li><p>Nova をインストールする前にデータベースを作成する必要がある</p><p><span class=label style=background-color:#f2a50c><span class=overlay style=margin-right:2px>#</span>root user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mysql
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#75715e># 以下は`MariaDB [(none)]&gt;`のプロンプトに入力する
</span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>DATABASE</span> nova_api;
<span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>DATABASE</span> nova;
<span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>DATABASE</span> nova_cell0;
<span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>ALL</span> <span style=color:#66d9ef>PRIVILEGES</span> <span style=color:#66d9ef>ON</span> nova_api.<span style=color:#f92672>*</span> <span style=color:#66d9ef>TO</span> <span style=color:#e6db74>&#39;nova&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;localhost&#39;</span> <span style=color:#66d9ef>IDENTIFIED</span> <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;NOVA_DBPASS&#39;</span>;
<span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>ALL</span> <span style=color:#66d9ef>PRIVILEGES</span> <span style=color:#66d9ef>ON</span> nova_api.<span style=color:#f92672>*</span> <span style=color:#66d9ef>TO</span> <span style=color:#e6db74>&#39;nova&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;%&#39;</span> <span style=color:#66d9ef>IDENTIFIED</span> <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;NOVA_DBPASS&#39;</span>;
<span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>ALL</span> <span style=color:#66d9ef>PRIVILEGES</span> <span style=color:#66d9ef>ON</span> nova.<span style=color:#f92672>*</span> <span style=color:#66d9ef>TO</span> <span style=color:#e6db74>&#39;nova&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;localhost&#39;</span> <span style=color:#66d9ef>IDENTIFIED</span> <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;NOVA_DBPASS&#39;</span>;
<span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>ALL</span> <span style=color:#66d9ef>PRIVILEGES</span> <span style=color:#66d9ef>ON</span> nova.<span style=color:#f92672>*</span> <span style=color:#66d9ef>TO</span> <span style=color:#e6db74>&#39;nova&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;%&#39;</span> <span style=color:#66d9ef>IDENTIFIED</span> <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;NOVA_DBPASS&#39;</span>;
<span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>ALL</span> <span style=color:#66d9ef>PRIVILEGES</span> <span style=color:#66d9ef>ON</span> nova_cell0.<span style=color:#f92672>*</span> <span style=color:#66d9ef>TO</span> <span style=color:#e6db74>&#39;nova&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;localhost&#39;</span> <span style=color:#66d9ef>IDENTIFIED</span> <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;NOVA_DBPASS&#39;</span>;
<span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>ALL</span> <span style=color:#66d9ef>PRIVILEGES</span> <span style=color:#66d9ef>ON</span> nova_cell0.<span style=color:#f92672>*</span> <span style=color:#66d9ef>TO</span> <span style=color:#e6db74>&#39;nova&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;%&#39;</span> <span style=color:#66d9ef>IDENTIFIED</span> <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;NOVA_DBPASS&#39;</span>;
</code></pre></div><ul><li><span class="label danger"><span class=overlay style=margin-right:2px>!</span>Caution</span>
<strong><code>NOVA_DBPASS</code>は適切なパスワードに書き換える</strong></li><li><code>nova_api</code>, <code>nova</code>, <code>nova_cell0</code>データベースの作成とアクセス権限の付与</li></ul></li><li><p><code>admin</code>環境スクリプトの読み込み</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>. admin-openrc
</code></pre></div></li><li><p>サービス資格情報</p><ul><li><p><code>nova</code>ユーザ作成</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack user create --domain default --password-prompt nova
<span style=color:#75715e># 対話形式のパスワードプロンプトがでる</span>
User Password:
Repeat User Password:
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>+---------------------+----------------------------------+
| Field               | Value                            |
+---------------------+----------------------------------+
| domain_id           | default                          |
| enabled             | True                             |
| id                  | 8a7dbf5279404537b1c7b86c033620fe |
| name                | nova                             |
| options             | <span style=color:#f92672>{}</span>                               |
| password_expires_at | None                             |
+---------------------+----------------------------------+
</code></pre></div><ul><li><span class="label danger"><span class=overlay style=margin-right:2px>!</span>Caution</span>
<strong>パスワードプロンプトでは<code>NOVA_PASS</code>を入力</strong></li></ul></li><li><p><code>service</code>プロジェクト、<code>nova</code>ユーザに<code>admin</code>の役割を割り当てる</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack role add --project service --user nova admin
</code></pre></div></li><li><p><code>compute</code>サービス (<code>name: nova</code>) を作成</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack service create --name nova --description <span style=color:#e6db74>&#34;OpenStack Compute&#34;</span> compute
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | OpenStack Compute                |
| enabled     | True                             |
| id          | 060d59eac51b4594815603d75a00aba2 |
| name        | nova                             |
| type        | compute                          |
+-------------+----------------------------------+
</code></pre></div></li></ul></li><li><p><code>compute</code>サービスに API エンドポイント作成</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack endpoint create --region RegionOne compute public http://controller:8774/v2.1
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>+--------------+-------------------------------------------+
| Field        | Value                                     |
+--------------+-------------------------------------------+
| enabled      | True                                      |
| id           | 3c1caa473bfe4390a11e7177894bcc7b          |
| interface    | public                                    |
| region       | RegionOne                                 |
| region_id    | RegionOne                                 |
| service_id   | 060d59eac51b4594815603d75a00aba2          |
| service_name | nova                                      |
| service_type | compute                                   |
| url          | http://controller:8774/v2.1               |
+--------------+-------------------------------------------+
</code></pre></div><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack endpoint create --region RegionOne compute internal http://controller:8774/v2.1
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>+--------------+-------------------------------------------+
| Field        | Value                                     |
+--------------+-------------------------------------------+
| enabled      | True                                      |
| id           | e3c918de680746a586eac1f2d9bc10ab          |
| interface    | internal                                  |
| region       | RegionOne                                 |
| region_id    | RegionOne                                 |
| service_id   | 060d59eac51b4594815603d75a00aba2          |
| service_name | nova                                      |
| service_type | compute                                   |
| url          | http://controller:8774/v2.1               |
+--------------+-------------------------------------------+
</code></pre></div><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack endpoint create --region RegionOne compute admin http://controller:8774/v2.1
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>+--------------+-------------------------------------------+
| Field        | Value                                     |
+--------------+-------------------------------------------+
| enabled      | True                                      |
| id           | 38f7af91666a47cfb97b4dc790b94424          |
| interface    | admin                                     |
| region       | RegionOne                                 |
| region_id    | RegionOne                                 |
| service_id   | 060d59eac51b4594815603d75a00aba2          |
| service_name | nova                                      |
| service_type | compute                                   |
| url          | http://controller:8774/v2.1               |
+--------------+-------------------------------------------+
</code></pre></div><ul><li><code>public</code>、<code>internal</code>、<code>admin</code>にそれぞれ作成</li></ul></li></ol><hr><h3 id=nova-api-インストール>Nova API インストール</h3><p><a href=https://docs.openstack.org/nova/ussuri/install/controller-install-ubuntu.html#install-and-configure-components><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1rem" height="1rem" style="fill:currentColor"><path d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg>OpenStack Docs: Install and configure controller node for Ubuntu - Install and configure components</a></p><ol><li><p>パッケージインストール</p><p><span class=label style=background-color:#f2a50c><span class=overlay style=margin-right:2px>#</span>root user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>apt install nova-api nova-conductor nova-novncproxy nova-scheduler
</code></pre></div></li><li><p><code>/etc/nova/nova.conf</code>編集</p><pre><code class=language-nova.conf data-lang=nova.conf>[DEFAULT]
# ...

# バグがあるようなので`log_dir`は消す
# log_dir = ...

# コントローラノードの管理ネットワークIPアドレス
# ex) my_ip = 192.168.0.11
my_ip = CONTROLLER_MANAGEMENT_IP

# `RABBIT_PASS`は適切なパスワードに書き換える
transport_url = rabbit://openstack:RABBIT_PASS@controller:5672/

# ...

[api_database]
# ...
# `NOVA_DBPASS`は適切なパスワードに書き換える
connection = mysql+pymysql://nova:NOVA_DBPASS@controller/nova_api

[database]
# ...
# `NOVA_DBPASS`は適切なパスワードに書き換える
connection = mysql+pymysql://nova:NOVA_DBPASS@controller/nova

[api]
# ...
# `keystone`を利用することを指定
auth_strategy = keystone

[keystone_authtoken]
# 他のオプションはすべて削除またはコメントアウトする
# `NOVA_PASS`は適切なパスワードに書き換える
www_authenticate_uri = http://controller:5000/
auth_url = http://controller:5000/
memcached_servers = controller:11211
auth_type = password
project_domain_name = Default
user_domain_name = Default
project_name = service
username = nova
password = NOVA_PASS

[neutron]
# 次の手順でインストールするNeutronの設定部分も先に書いておく
# 他のオプションはすべて削除またはコメントアウトする
# `NEUTRON_PASS`、`METADATA_SECRET`は適切なパスワードに書き換える
auth_url = http://controller:5000
auth_type = password
project_domain_name = default
user_domain_name = default
region_name = RegionOne
project_name = service
username = neutron
password = NEUTRON_PASS
service_metadata_proxy = true
metadata_proxy_shared_secret = METADATA_SECRET

[vnc]
# ...
enabled = true
server_listen = $my_ip
server_proxyclient_address = $my_ip

[glance]
# ...
# GlanceのAPIサーバ
api_servers = http://controller:9292

[oslo_concurrency]
# ...
lock_path = /var/lib/nova/tmp

[placement]
# 他のオプションはすべて削除またはコメントアウトする
# `PLACEMENT_PASS`は適切なパスワードに書き換える
region_name = RegionOne
project_domain_name = Default
project_name = service
auth_type = password
user_domain_name = Default
auth_url = http://controller:5000/v3
username = placement
password = PLACEMENT_PASS

# ...
</code></pre><ul><li><p><span class="label danger"><span class=overlay style=margin-right:2px>!</span>Caution</span>
<strong><code>RABBIT_PASS</code>は適切なパスワードに書き換える</strong></p></li><li><p><span class="label danger"><span class=overlay style=margin-right:2px>!</span>Caution</span>
<strong><code>NOVA_DBPASS</code>は適切なパスワードに書き換える</strong></p></li><li><p><span class="label danger"><span class=overlay style=margin-right:2px>!</span>Caution</span>
<strong><code>NOVA_PASS</code>は適切なパスワードに書き換える</strong></p></li><li><p><span class="label danger"><span class=overlay style=margin-right:2px>!</span>Caution</span>
<strong><code>NEUTRON_PASS</code>は適切なパスワードに書き換える</strong></p></li><li><p><span class="label danger"><span class=overlay style=margin-right:2px>!</span>Caution</span>
<strong><code>METADATA_SECRET</code>は適切なパスワードに書き換える</strong></p></li><li><p><span class="label danger"><span class=overlay style=margin-right:2px>!</span>Caution</span>
<strong><code>PLACEMENT_PASS</code>は適切なパスワードに書き換える</strong></p></li><li><p>ちなみに、コントローラノードとコンピュートノードを分離しない All-in-One 構成の場合は
コントローラノードの処理にメモリや CPU を事前に予約しておくといいかも…？です</p><pre><code class=language-nova.conf data-lang=nova.conf>[DEFAULT]
# ...
reserved_host_memory_mb = 4096
reserved_host_cpus = 2
</code></pre><ul><li>上の例ではメモリ 4G と CPU2 スレッド（単位はコアではなくスレッドのはず）をコンピュートノード用に事前確保している</li><li>（特にチューニングしたわけではないので、いくつにすればよいかは不明です）</li></ul></li></ul></li><li><p>Nova API データベース同期</p><p><span class=label style=background-color:#f2a50c><span class=overlay style=margin-right:2px>#</span>root user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>su -s /bin/sh -c <span style=color:#e6db74>&#34;nova-manage api_db sync&#34;</span> nova
</code></pre></div></li><li><p><code>cell0</code>データベース登録</p><p><span class=label style=background-color:#f2a50c><span class=overlay style=margin-right:2px>#</span>root user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>su -s /bin/sh -c <span style=color:#e6db74>&#34;nova-manage cell_v2 map_cell0&#34;</span> nova
</code></pre></div><ul><li>Nova ではスケーラビリティのためにマルチセル方式を採用している</li><li>セルの中でも<code>cell0</code>は特別なセルであり、最小限の DB 情報しかもっていないらしい</li><li>よくわかってないので気になったら調べてください</li></ul></li><li><p><code>cell1</code>セル作成</p><p><span class=label style=background-color:#f2a50c><span class=overlay style=margin-right:2px>#</span>root user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>su -s /bin/sh -c <span style=color:#e6db74>&#34;nova-manage cell_v2 create_cell --name=cell1 --verbose&#34;</span> nova
</code></pre></div><ul><li>Nova ではスケーラビリティのためにマルチセル方式を採用している</li><li><code>cell1</code>は実際に VM インスタンスを建てたりするセルになるみたい</li></ul></li><li><p>Nova データベース同期</p><p><span class=label style=background-color:#f2a50c><span class=overlay style=margin-right:2px>#</span>root user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>su -s /bin/sh -c <span style=color:#e6db74>&#34;nova-manage db sync&#34;</span> nova
</code></pre></div></li><li><p>セルの登録確認</p><p><span class=label style=background-color:#f2a50c><span class=overlay style=margin-right:2px>#</span>root user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>su -s /bin/sh -c <span style=color:#e6db74>&#34;nova-manage cell_v2 list_cells&#34;</span> nova
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>+-------+--------------------------------------+----------------------------------------------------+--------------------------------------------------------------+----------+
|  Name |                 UUID                 |                   Transport URL                    |                     Database Connection                      | Disabled |
+-------+--------------------------------------+----------------------------------------------------+--------------------------------------------------------------+----------+
| cell0 | 00000000-0000-0000-0000-000000000000 |                       none:/                       | mysql+pymysql://nova:****@controller/nova_cell0?charset<span style=color:#f92672>=</span>utf8 |  False   |
| cell1 | f690f4fd-2bc5-4f15-8145-db561a7b9d3d | rabbit://openstack:****@controller:5672/nova_cell1 | mysql+pymysql://nova:****@controller/nova_cell1?charset<span style=color:#f92672>=</span>utf8 |  False   |
+-------+--------------------------------------+----------------------------------------------------+--------------------------------------------------------------+----------+
</code></pre></div></li></ol><hr><h3 id=コントローラノードのサービス再起動>コントローラノードのサービス再起動</h3><p><a href=https://docs.openstack.org/nova/ussuri/install/controller-install-ubuntu.html#finalize-installation><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1rem" height="1rem" style="fill:currentColor"><path d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg>OpenStack Docs: Install and configure controller node for Ubuntu - Finalize installation</a></p><p><span class=label style=background-color:#f2a50c><span class=overlay style=margin-right:2px>#</span>root user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>systemctl restart nova-api
systemctl restart nova-scheduler
systemctl restart nova-conductor
systemctl restart nova-novncproxy
</code></pre></div><hr><h2 id=コンピュートノード>コンピュートノード</h2><p><a href=https://docs.openstack.org/nova/ussuri/install/compute-install-ubuntu.html><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1rem" height="1rem" style="fill:currentColor"><path d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg>OpenStack Docs: Install and configure a compute node for Ubuntu</a></p><p><span class=label style=background-color:#0c7ff2>Compute</span></p><ul><li>コンピュートノードでは実際に VM インスタンスの作成、起動、停止などをおこなう</li><li>ドキュメントの構成では KVM/QEMU の<code>libvirt</code>をもとにする</li></ul><h3 id=nova-compute-インストール>Nova Compute インストール</h3><p><a href=https://docs.openstack.org/nova/ussuri/install/compute-install-ubuntu.html#install-and-configure-components><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1rem" height="1rem" style="fill:currentColor"><path d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg>OpenStack Docs: Install and configure a compute node for Ubuntu - Install and configure components</a></p><ol><li><p>パッケージインストール</p><p><span class=label style=background-color:#f2a50c><span class=overlay style=margin-right:2px>#</span>root user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>apt install nova-compute
</code></pre></div></li><li><p><code>/etc/nova/nova.conf</code>編集</p><pre><code class=language-nova.conf data-lang=nova.conf>[DEFAULT]
# ...

# コンピュートノードの管理ネットワークIPアドレス
# ex) my_ip = 192.168.0.12
my_ip = COMPUTE_MANAGEMENT_IP

# `RABBIT_PASS`は適切なパスワードに書き換える
transport_url = rabbit://openstack:RABBIT_PASS@controller

# ...

[api]
# ...
# `keystone`を利用することを指定
auth_strategy = keystone

[keystone_authtoken]
# 他のオプションはすべて削除またはコメントアウトする
# `NOVA_PASS`は適切なパスワードに書き換える
www_authenticate_uri = http://controller:5000/
auth_url = http://controller:5000/
memcached_servers = controller:11211
auth_type = password
project_domain_name = Default
user_domain_name = Default
project_name = service
username = nova
password = NOVA_PASS

[neutron]
# 次の手順でインストールするNeutronの設定部分も先に書いておく
# 他のオプションはすべて削除またはコメントアウトする
# `NEUTRON_PASS`は適切なパスワードに書き換える
auth_url = http://controller:5000
auth_type = password
project_domain_name = default
user_domain_name = default
region_name = RegionOne
project_name = service
username = neutron
password = NEUTRON_PASS

[vnc]
# ...
enabled = true
server_listen = 0.0.0.0
server_proxyclient_address = $my_ip

# 以下のURLはHorizonでWebコンソールを開くときのリンクアドレスになる
# ドキュメントの通り`http://controller:6080/vnc_auto.html`とすると
# ブラウザで`http://controller:6080/vnc_auto.html`にアクセスしようとしてしまう
# アクセス可能なドメイン名またはIPアドレスに書き換えること
novncproxy_base_url = http://[Accessable Domain Name / IP Address]:6080/vnc_auto.html

[glance]
# ...
# GlanceのAPIサーバ
api_servers = http://controller:9292

[oslo_concurrency]
# ...
lock_path = /var/lib/nova/tmp

[placement]
# 他のオプションはすべて削除またはコメントアウトする
# `PLACEMENT_PASS`は適切なパスワードに書き換える
region_name = RegionOne
project_domain_name = Default
project_name = service
auth_type = password
user_domain_name = Default
auth_url = http://controller:5000/v3
username = placement
password = PLACEMENT_PASS

# ...
</code></pre><ul><li><span class="label danger"><span class=overlay style=margin-right:2px>!</span>Caution</span>
<strong><code>RABBIT_PASS</code>は適切なパスワードに書き換える</strong></li><li><span class="label danger"><span class=overlay style=margin-right:2px>!</span>Caution</span>
<strong><code>NOVA_DBPASS</code>は適切なパスワードに書き換える</strong></li><li><span class="label danger"><span class=overlay style=margin-right:2px>!</span>Caution</span>
<strong><code>NOVA_PASS</code>は適切なパスワードに書き換える</strong></li><li><span class="label danger"><span class=overlay style=margin-right:2px>!</span>Caution</span>
<strong><code>NEUTRON_PASS</code>は適切なパスワードに書き換える</strong></li><li><span class="label danger"><span class=overlay style=margin-right:2px>!</span>Caution</span>
<strong><code>PLACEMENT_PASS</code>は適切なパスワードに書き換える</strong></li></ul></li><li><p>KVM 対応確認</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>egrep -c <span style=color:#e6db74>&#39;(vmx|svm)&#39;</span> /proc/cpuinfo
</code></pre></div><ul><li><p><code>1</code>以上の値の場合 KVM に対応している（追加設定の必要なし）</p></li><li><p><code>0</code>を返す場合は KVM に対応していないので仮想化すべてを QEMU でおこなうように設定する必要がある<br><code>/etc/nova/nova-compute.conf</code>編集</p><pre><code class=language-nova-compute.conf data-lang=nova-compute.conf>[libvirt]
# ...
# libvirtが仮想化すべてをQEMUでおこなうように設定
virt_type = qemu
</code></pre></li><li><p>コンピュートノードが物理マシンの場合は BIOS で INTEL VT-X あるいは AMD-V の仮想化ハードウェア拡張を有効化すれば KVM 利用可能になるはず</p></li><li><p>コンピュートノードが仮想マシンの場合はハイパーバイザ側で VM に INTEL VT-X あるいは AMD-V の仮想化ハードウェア拡張を有効化するよう設定すれば KVM 利用可能になるはず</p></li><li><p><strong>KVM 対応させた方が仮想 CPU のパフォーマンスが圧倒的にあがるらしいので対応させておくとよい</strong></p></li></ul></li></ol><hr><h3 id=コンピュートノードのサービス再起動>コンピュートノードのサービス再起動</h3><p><a href=https://docs.openstack.org/nova/ussuri/install/compute-install-ubuntu.html#finalize-installation><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1rem" height="1rem" style="fill:currentColor"><path d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg>OpenStack Docs: Install and configure a compute node for Ubuntu - Finalize installation</a></p><p><span class=label style=background-color:#f2a50c><span class=overlay style=margin-right:2px>#</span>root user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>systemctl restart nova-compute
</code></pre></div><hr><h2 id=コンピュートノードをコントローラノードのセルデータベースに追加する>コンピュートノードをコントローラノードのセルデータベースに追加する</h2><p><a href=https://docs.openstack.org/nova/ussuri/install/compute-install-ubuntu.html#add-the-compute-node-to-the-cell-database><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1rem" height="1rem" style="fill:currentColor"><path d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg>OpenStack Docs: Install and configure a compute node for Ubuntu - Add the compute node to the cell database</a></p><p><span class=label style=background-color:#053260>Controller</span></p><ol><li><p><code>admin</code>環境スクリプトの読み込み</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>. admin-openrc
</code></pre></div></li><li><p>データベースにコンピュートホストが存在することを確認する</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack compute service list --service nova-compute
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>+----+-------+--------------+------+-------+---------+----------------------------+
| ID | Host  | Binary       | Zone | State | Status  | Updated At                 |
+----+-------+--------------+------+-------+---------+----------------------------+
| <span style=color:#ae81ff>1</span>  | node1 | nova-compute | nova | up    | enabled | 2017-04-14T15:30:44.000000 |
+----+-------+--------------+------+-------+---------+----------------------------+
</code></pre></div></li><li><p>コンピュートホストを検出してセルデータベースに追加</p><p><span class=label style=background-color:#f2a50c><span class=overlay style=margin-right:2px>#</span>root user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>su -s /bin/sh -c <span style=color:#e6db74>&#34;nova-manage cell_v2 discover_hosts --verbose&#34;</span> nova
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>Found <span style=color:#ae81ff>2</span> cell mappings.
Skipping cell0 since it does not contain hosts.
Getting compute nodes from cell <span style=color:#e6db74>&#39;cell1&#39;</span>: ad5a5985-a719-4567-98d8-8d148aaae4bc
Found <span style=color:#ae81ff>1</span> computes in cell: ad5a5985-a719-4567-98d8-8d148aaae4bc
Checking host mapping <span style=color:#66d9ef>for</span> compute host <span style=color:#e6db74>&#39;compute&#39;</span>: fe58ddc1-1d65-4f87-9456-bc040dc106b3
Creating host mapping <span style=color:#66d9ef>for</span> compute host <span style=color:#e6db74>&#39;compute&#39;</span>: fe58ddc1-1d65-4f87-9456-bc040dc106b3
</code></pre></div></li></ol><ul><li><p>コンピュートノードを追加構築するたびに以上の手順をするか、<code>/etc/nova/nova.conf</code>に自動検出するための設定を書く必要がある</p><ul><li><p>自動検出したい場合は<code>/etc/nova/nova.conf</code>編集</p><pre><code class=language-nova.conf data-lang=nova.conf># ...

[scheduler]
# ...
# 単位は秒？
# 設定する場合は適切な値を調べてください
discover_hosts_in_cells_interval = 300

# ...
</code></pre><ul><li>試してないので動作保証できません</li></ul></li></ul></li></ul><hr><h2 id=動作確認>動作確認</h2><p><a href=https://docs.openstack.org/nova/ussuri/install/verify.html><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1rem" height="1rem" style="fill:currentColor"><path d="M432 320H4e2a16 16 0 00-16 16V448H64V128H208a16 16 0 0016-16V80a16 16 0 00-16-16H48A48 48 0 000 112V464a48 48 0 0048 48H4e2a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37.0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0L435.28 133.32 471 169c15 15 41 4.5 41-17V24A24 24 0 00488 0z"/></svg>OpenStack Docs: Verify operation</a></p><p><span class=label style=background-color:#053260>Controller</span></p><ol><li><p><code>admin</code>環境スクリプトの読み込み</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>. admin-openrc
</code></pre></div></li><li><p>Nova のサービス一覧を表示</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack compute service list
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>+----+--------------------+------------+----------+---------+-------+----------------------------+
| Id | Binary             | Host       | Zone     | Status  | State | Updated At                 |
+----+--------------------+------------+----------+---------+-------+----------------------------+
|  <span style=color:#ae81ff>1</span> | nova-scheduler     | controller | internal | enabled | up    | 2016-02-09T23:11:15.000000 |
|  <span style=color:#ae81ff>2</span> | nova-conductor     | controller | internal | enabled | up    | 2016-02-09T23:11:16.000000 |
|  <span style=color:#ae81ff>3</span> | nova-compute       | compute1   | nova     | enabled | up    | 2016-02-09T23:11:20.000000 |
+----+--------------------+------------+----------+---------+-------+----------------------------+
</code></pre></div></li><li><p>API エンドポイント一覧を表示</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack catalog list
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>+-----------+-----------+-----------------------------------------+
| Name      | Type      | Endpoints                               |
+-----------+-----------+-----------------------------------------+
| keystone  | identity  | RegionOne                               |
|           |           |   public: http://controller:5000/v3/    |
|           |           | RegionOne                               |
|           |           |   internal: http://controller:5000/v3/  |
|           |           | RegionOne                               |
|           |           |   admin: http://controller:5000/v3/     |
|           |           |                                         |
| glance    | image     | RegionOne                               |
|           |           |   admin: http://controller:9292         |
|           |           | RegionOne                               |
|           |           |   public: http://controller:9292        |
|           |           | RegionOne                               |
|           |           |   internal: http://controller:9292      |
|           |           |                                         |
| nova      | compute   | RegionOne                               |
|           |           |   admin: http://controller:8774/v2.1    |
|           |           | RegionOne                               |
|           |           |   internal: http://controller:8774/v2.1 |
|           |           | RegionOne                               |
|           |           |   public: http://controller:8774/v2.1   |
|           |           |                                         |
| placement | placement | RegionOne                               |
|           |           |   public: http://controller:8778        |
|           |           | RegionOne                               |
|           |           |   admin: http://controller:8778         |
|           |           | RegionOne                               |
|           |           |   internal: http://controller:8778      |
|           |           |                                         |
+-----------+-----------+-----------------------------------------+
</code></pre></div></li><li><p>イメージ一覧を表示</p><p><span class=label style=background-color:#3fbf3f><span class=overlay style=margin-right:2px>$</span>any user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openstack image list
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>+--------------------------------------+-------------+-------------+
| ID                                   | Name        | Status      |
+--------------------------------------+-------------+-------------+
| 9a76d9f9-9620-4f2e-8c69-6c5691fae163 | cirros      | active      |
+--------------------------------------+-------------+-------------+
</code></pre></div></li><li><p>ステータスチェック</p><p><span class=label style=background-color:#f2a50c><span class=overlay style=margin-right:2px>#</span>root user</span></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>nova-status upgrade check
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>+--------------------------------------------------------------------+
| Upgrade Check Results                                              |
+--------------------------------------------------------------------+
| Check: Cells v2                                                    |
| Result: Success                                                    |
| Details: None                                                      |
+--------------------------------------------------------------------+
| Check: Placement API                                               |
| Result: Success                                                    |
| Details: None                                                      |
+--------------------------------------------------------------------+
| Check: Ironic Flavor Migration                                     |
| Result: Success                                                    |
| Details: None                                                      |
+--------------------------------------------------------------------+
| Check: Cinder API                                                  |
| Result: Success                                                    |
| Details: None                                                      |
+--------------------------------------------------------------------+
| Check: Policy Scope-based Defaults                                 |
| Result: Success                                                    |
| Details: None                                                      |
+--------------------------------------------------------------------+
</code></pre></div></li></ol><hr><h2 id=おわり>おわり</h2><p>以上で Nova 編終了です<br>お疲れ様でした</p><h3 id=関連記事一覧>関連記事一覧</h3><ul><li><a href=https://aton-kish.github.io/blog/post/2020/09/11/openstack-ussuri-installation/>OpenStack Ussuriをマニュアルインストールしてみたメモ</a><ol><li><a href=https://aton-kish.github.io/blog/post/2020/09/12/openstack-ussuri-environment/>OpenStack Ussuriマニュアルインストールその１―環境構築編</a></li><li><a href=https://aton-kish.github.io/blog/post/2020/09/13/openstack-ussuri-keystone/>OpenStack Ussuriマニュアルインストールその２―Keystone編</a></li><li><a href=https://aton-kish.github.io/blog/post/2020/09/14/openstack-ussuri-glance/>OpenStack Ussuriマニュアルインストールその３―Glance編</a></li><li><a href=https://aton-kish.github.io/blog/post/2020/09/15/openstack-ussuri-placement/>OpenStack Ussuriマニュアルインストールその４―Placement編</a></li><li>OpenStack Ussuriマニュアルインストールその５―Nova編（当記事）</li><li><a href=https://aton-kish.github.io/blog/post/2020/09/16/openstack-ussuri-neutron/>OpenStack Ussuriマニュアルインストールその６―Neutron編</a></li><li><a href=https://aton-kish.github.io/blog/post/2020/09/17/openstack-ussuri-horizon/>OpenStack Ussuriマニュアルインストールその７―Horizon編</a></li><li><a href=https://aton-kish.github.io/blog/post/2020/09/18/openstack-ussuri-cinder/>OpenStack Ussuriマニュアルインストールその８―Cinder編</a></li><li><a href=https://aton-kish.github.io/blog/post/2020/09/19/openstack-ussuri-launch/>OpenStack Ussuriマニュアルインストールその９―起動編</a></li><li><a href=https://aton-kish.github.io/blog/post/2021/02/13/openstack-ussuri-octavia/>OpenStack Ussuri 追加インストールその１―Octavia編</a></li></ol></li><li><a href=https://aton-kish.github.io/blog/post/2021/03/14/openstack-victoria-installation/>OpenStack Victoriaをマニュアルインストールしてみたメモ</a></li><li><a href=https://aton-kish.github.io/blog/post/2020/11/27/openstack-tips/>OpenStack Tips</a></li><li>Issues<ol><li><a href=https://aton-kish.github.io/blog/post/2021/03/15/openstack-issue-ebtables/>Openstack Issueその１―正常に見えるのに大量にネットワークエラーが…</a></li><li><a href=https://aton-kish.github.io/blog/post/2021/03/15/openstack-issue-ipv6/>Openstack Issueその２―VMと疎通がとれない…</a></li><li><a href=https://aton-kish.github.io/blog/post/2021/03/15/openstack-issue-nonadmin-horizon/>Openstack Issueその３―Horizon「どこかがおかしくなりました」</a></li></ol></li></ul></article></div></div></div></div></main></div></div><div class="footer container-lg width-full p-responsive" role=contentinfo><div class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light"><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"><li class="mr-3 mr-lg-0">© 2020 Aton-Kish</a></li></ul><a aria-label=Homepage title=Nota class="footer-octicon d-none d-lg-block mx-lg-4" href=https://aton-kish.github.io/blog/><svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" width="24" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"></ul></div><div class="d-flex flex-justify-center pb-6"><span class="f6 text-gray-light"></span></div></div><script crossorigin=anonymous type=application/javascript src=https://aton-kish.github.io/blog/js/frameworks.js></script><script crossorigin=anonymous type=application/javascript src=https://aton-kish.github.io/blog/js/github-bootstrap.js></script><script src=https://aton-kish.github.io/blog/js/stop.js></script><script src=https://aton-kish.github.io/blog/js/contributions.js></script></body></html>